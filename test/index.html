<!DOCTYPE html>
<html>
  <head>
    <title>iFrame Rendering</title>
  </head>
  <script src="https://unpkg.com/penpal/dist/penpal.min.js"></script>

  <body>
    <button id="render-certificate" onclick="renderDocument(certificate)">
      Render Certificate
    </button>

    <div id="template-selectors"></div>

    <iframe
      title="Rendered Certificate"
      id="frameless-iframe"
      src="http://localhost:3000"
      style="width: 100%; border: 0px; overflow: hidden;"
    ></iframe>
  </body>

  <script type="text/javascript">
    const iframe = document.getElementById("frameless-iframe");
    var iframeMethods;
    selectTemplateTab = function(i) {
      window.connection.promise.then(frame => frame.selectTemplateTab(i));
    };
    updateHeight = function(h) {
      iframe.height = h;
    };
    updateTemplates = function(templates) {
      if (!templates) return;
      const templateSelector = document.getElementById("template-selectors");
      templateSelector.innerHTML = "";
      templates.forEach((tab, index) => {
        const btn = document.createElement("button");
        btn.innerHTML = tab.label;
        btn.id = `selector-${tab.id}`;
        btn.onclick = () => selectTemplateTab(index);
        templateSelector.appendChild(btn);
      });
    };
    window.connection = window.Penpal.connectToChild({
      iframe,
      methods: {
        updateHeight,
        updateTemplates
      }
    });
    renderDocument = function(cert) {
      window.connection.promise.then(frame => frame.renderDocument(cert));
    };
    const certificate = {
      id: "A182470ZC43306037",
      $template: {
        name: "CERTIFICATE_OF_ORIGIN",
        type: "EMBEDDED_RENDERER",
        url: "https://demo-co.openattestation.com"
      },
      documentUrl: "google.com",
      issuedDate: "2018-01-09",
      issuers: [
        {
          name: "DEMO STORE",
          address: {
            street: "135 DONNYBROOK RD",
            city: "MELBOURNE",
            state: "VICTORIA",
            country: "AUSTRALIA"
          },
          contact: {
            tel: "+61-3-93911627",
            fax: "+61-3-93911687"
          },
          documentStore: "0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d"
        }
      ],
      exporter: {
        name: "FINE RED'S",
        address: {
          street: "90 COLLINS ST",
          city: "MELBOURNE",
          state: "VICTORIA",
          country: "AUSTRALIA"
        }
      },
      producer: {
        name: "PERFECT PINOT LTD",
        address: {
          street: "309 KING ST",
          city: "MELBOURNE",
          state: "VICTORIA",
          country: "AUSTRALIA"
        }
      },
      importer: {
        name: "HUNAN WINES",
        address: {
          street: "EAST JIEFANG ROAD",
          city: "CHANGSHA",
          state: "HUNAN",
          country: "CHINA"
        }
      },
      transport: {
        departureDate: "2018-01-11",
        vehicleNo: "CZ3073/11-JAN",
        loadingPort: "MELBOURNE, AUSTRALIA",
        dischargePort: "HUNAN, CHINA"
      },
      remarks: "",
      items: [
        {
          marks: "",
          description: "16667 CARTONS OF RED WINE",
          hsCode: "220429",
          originCriterion: "WP",
          quantity: {
            value: 5000,
            unit: "LITRES"
          },
          invoiceNo: 24082011,
          invoiceDate: "2018-01-07"
        }
      ]
    };
    // setInterval(() => renderDocument(certificate), 300);
  </script>
</html>
